apiVersion: securityinsights.azure.upbound.io/v1alpha1
kind: SentinelAlertRuleScheduled
metadata:
  name: example
spec:
  forProvider:
    displayName: example
    logAnalyticsWorkspaceId: ${azurerm_log_analytics_solution.example.workspace_resource_id}
    name: example
    query: |
      AzureActivity |
        where OperationName == "Create or Update Virtual Machine" or OperationName =="Create Deployment" |
        where ActivityStatus == "Succeeded" |
        make-series dcount(ResourceId) default=0 on EventSubmissionTimestamp in range(ago(7d), now(), 1d) by Caller
    severity: High
  providerConfigRef:
    name: example
